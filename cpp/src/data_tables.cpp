#include "data_tables.hpp"
#include <map>
#include <string>

// Converted from Python data_matrix
const std::vector<std::vector<uint16_t>> DATA_MATRIX = {
    {0x00, 0x00, 0x02}, {0x00, 0x02, 0x02}, {0x00, 0x04, 0x05}, {0x00, 0x0D, 0x04},
    {0x00, 0x11, 0x04}, {0x00, 0x15, 0x04}, {0x00, 0x19, 0x04}, {0x00, 0x23, 0x14},
    {0x00, 0x37, 0x04}, {0x00, 0x69, 0x02}, {0x00, 0x7B, 0x01}, {0x40, 0x00, 0x04},
    {0x40, 0x0A, 0x0A}, {0x40, 0x14, 0x02}, {0x40, 0x16, 0x02}, {0x40, 0x19, 0x02},
    {0x40, 0x1B, 0x02}, {0x40, 0x1D, 0x02}, {0x40, 0x1F, 0x02}, {0x60, 0x00, 0x02},
    {0x60, 0x02, 0x02}, {0x60, 0x04, 0x04}, {0x60, 0x08, 0x04}, {0x60, 0x0C, 0x02},
    {0x90, 0x00, 0x3A}, {0x90, 0x3A, 0x3A}, {0x90, 0x74, 0x3A}, {0x90, 0xAE, 0x3A},
    {0x90, 0xE8, 0x3A}, {0x91, 0x22, 0x30}, {0x91, 0x52, 0x00}, {0xA0, 0x00, 0x06}
};

// Battery type lookup table
const std::map<std::string, std::pair<float, std::string>> BATTERY_LOOKUP = {
    {"36", {1.5, "1.5Ah CP (5s1p 18650)"}},
    {"37", {2.0, "2Ah CP (5s1p 18650)"}},
    {"38", {3.0, "3Ah XC (5s2p 18650)"}},
    {"39", {4.0, "4Ah XC (5s2p 18650)"}},
    {"40", {5.0, "5Ah XC (5s2p 18650) (<= Dec 2018)"}},
    {"165", {5.0, "5Ah XC (5s2p 18650) (Aug 2019 - Jun 2021)"}},
    {"306", {5.0, "5Ah XC (5s2p 18650) (Feb 2021 - Jul 2023)"}},
    {"424", {5.0, "5Ah XC (5s2p 18650) (>= Sep 2023)"}},
    {"46", {6.0, "6Ah XC (5s2p 18650)"}},
    {"47", {9.0, "9Ah HD (5s3p 18650)"}},
    {"104", {3.0, "3Ah HO (5s1p 21700)"}},
    {"150", {5.5, "5.5Ah HO (5s2p 21700) (EU only)"}},
    {"106", {6.0, "6Ah HO (5s2p 21700)"}},
    {"107", {8.0, "8Ah HO (5s2p 21700)"}},
    {"108", {12.0, "12Ah HO (5s3p 21700)"}},
    {"383", {8.0, "8Ah Forge (5s2p 21700 tabless)"}},
    {"384", {12.0, "12Ah Forge (5s3p 21700 tabless)"}}
};

// Data ID table (address, length, type, label)
const std::vector<std::vector<std::string>> DATA_ID = {
    {"0x0000", "2", "uint", "Cell type"},
    {"0x0002", "2", "uint", "Unknown (always 0)"},
    {"0x0004", "5", "sn", "Capacity & Serial number (?)"},
    {"0x000D", "4", "uint", "Unknown (4th code?)"},
    {"0x0011", "4", "date", "Manufacture date"},
    {"0x0015", "4", "date", "Date of first charge (Forge)"},
    {"0x0019", "4", "date", "Date of last charge (Forge)"},
    {"0x0023", "20", "ascii", "Note (ascii string)"},
    {"0x0037", "4", "date", "Current date"},
    {"0x0069", "2", "uint", "Unknown (always 2)"},
    {"0x007B", "1", "uint", "Unknown (always 0)"},
    {"0x4000", "4", "uint", "Unknown (Forge)"},
    {"0x400A", "10", "cell_v", "Cell voltages (mV)"},
    {"0x4014", "2", "adc_t", "Temperature (C) (non-Forge)"},
    {"0x4016", "2", "uint", "Unknown (Forge)"},
    {"0x4019", "2", "uint", "Unknown (Forge)"},
    {"0x401B", "2", "uint", "Unknown (Forge)"},
    {"0x401D", "2", "uint", "Unknown (Forge)"},
    {"0x401F", "2", "dec_t", "Temperature (C) (Forge)"},
    {"0x6000", "2", "uint", "Unknown (Forge)"},
    {"0x6002", "2", "uint", "Unknown (Forge)"},
    {"0x6004", "4", "uint", "Unknown (Forge)"},
    {"0x6008", "4", "uint", "Unknown (Forge)"},
    {"0x600C", "2", "uint", "Unknown (Forge)"},
    {"0x9000", "4", "date", "Date of first charge (rounded)"},
    {"0x9004", "4", "date", "Date of last tool use (rounded)"},
    {"0x9008", "4", "date", "Date of last charge (rounded)"},
    {"0x900C", "4", "date", "Unknown date (often zero)"},
    {"0x9010", "2", "uint", "Days since first charge"},
    {"0x9012", "4", "uint", "Total discharge (amp-sec)"},
    {"0x9016", "4", "uint", "Total discharge (watt-sec or joules)"},
    {"0x901A", "4", "uint", "Total charge count"},
    {"0x901E", "2", "uint", "Dumb charge count (J2>7.1V for >=0.48s)"},
    {"0x9020", "2", "uint", "Redlink (UART) charge count"},
    {"0x9022", "2", "uint", "Completed charge count (?)"},
    {"0x9024", "4", "hhmmss", "Total charging time (HH:MM:SS)"},
    {"0x9028", "4", "hhmmss", "Time on charger whilst full (HH:MM:SS)"},
    {"0x902C", "2", "uint", "Unknown (another low-voltage charge counter?)"},
    {"0x902E", "2", "uint", "Charge started with a cell < 2.5V"},
    {"0x9030", "2", "uint", "Discharge to empty"},
    {"0x9032", "2", "uint", "Num. overheat on tool (must be > 10A)"},
    {"0x9034", "2", "uint", "Overcurrent?"},
    {"0x9036", "2", "uint", "Low voltage events)"},
    {"0x9038", "2", "uint", "Low-voltage bounce? (4 flashing LEDs)"},
    {"0x903A", "2", "uint", "Discharge @ 10-20A (seconds)"},
    {"0x903C", "2", "uint", "@ 20-30A (could be watts)"},
    {"0x903E", "2", "uint", "@ 30-40A"},
    {"0x9040", "2", "uint", "@ 40-50A"},
    {"0x9042", "2", "uint", "@ 50-60A"},
    {"0x9044", "2", "uint", "@ 60-70A"},
    {"0x9046", "2", "uint", "@ 70-80A"},
    {"0x9048", "2", "uint", "@ 80-90A"},
    {"0x904A", "2", "uint", "@ 90-100A"},
    {"0x904C", "2", "uint", "@ 100-110A"},
    {"0x904E", "2", "uint", "@ 110-120A"},
    {"0x9050", "2", "uint", "@ 120-130A"},
    {"0x9052", "2", "uint", "@ 130-140A"},
    {"0x9054", "2", "uint", "@ 140-150A"},
    {"0x9056", "2", "uint", "@ 150-160A"},
    {"0x9058", "2", "uint", "@ 160-170A"},
    {"0x905A", "2", "uint", "@ 170-180A"},
    {"0x905C", "2", "uint", "@ 180-190A"},
    {"0x905E", "2", "uint", "@ 190-200A"},
    {"0x9060", "2", "uint", "@ 200-210A"},
    {"0x9062", "2", "uint", "Discharge @ 5-10A (seconds)"},
    {"0x9064", "2", "uint", "@ 10-15A (could be watts)"},
    {"0x9066", "2", "uint", "@ 15-20A (histo not well understood yet)"},
    {"0x9068", "2", "uint", "@ 20-25A"},
    {"0x906A", "2", "uint", "@ 25-30A"},
    {"0x906C", "2", "uint", "@ 30-35A"},
    {"0x906E", "2", "uint", "@ 35-40A"},
    {"0x9070", "2", "uint", "@ 40-45A"},
    {"0x9072", "2", "uint", "@ 45-50A"},
    {"0x9074", "2", "uint", "@ 50-55A"},
    {"0x9076", "2", "uint", "@ 55-60A"},
    {"0x9078", "2", "uint", "@ 60-65A"},
    {"0x907A", "2", "uint", "@ 65-70A"},
    {"0x907C", "2", "uint", "@ 70-65A"},
    {"0x907E", "2", "uint", "@ 75-80A"},
    {"0x9080", "2", "uint", "@ 80-85A"},
    {"0x9082", "2", "uint", "@ 85-90A"},
    {"0x9084", "2", "uint", "@ 90-95A"},
    {"0x9086", "2", "uint", "@ 95-100A"},
    {"0x9088", "2", "uint", "@ 100-105A"},
    {"0x908A", "2", "uint", "@ 105-110A"},
    {"0x908C", "2", "uint", "@ 110-115A"},
    {"0x908E", "2", "uint", "@ 115-120A"},
    {"0x9090", "2", "uint", "@ 120-125A"},
    {"0x9092", "2", "uint", "@ 125-130A"},
    {"0x9094", "2", "uint", "@ 130-135A"},
    {"0x9096", "2", "uint", "@ 135-140A"},
    {"0x9098", "2", "uint", "@ 140-145A"},
    {"0x909A", "2", "uint", "@ 145-150A"},
    {"0x909C", "2", "uint", "@ 150-155A"},
    {"0x909E", "2", "uint", "@ 155-160A"},
    {"0x90A0", "2", "uint", "@ 160-165A"},
    {"0x90A2", "2", "uint", "@ 165-170A"},
    {"0x90A4", "2", "uint", "@ 170-175A"},
    {"0x90A6", "2", "uint", "@ 175-180A"},
    {"0x90A8", "2", "uint", "@ 180-185A"},
    {"0x90AA", "2", "uint", "@ 185-190A"},
    {"0x90AC", "2", "uint", "@ 190-195A"},
    {"0x90AE", "2", "uint", "@ 195-200A"},
    {"0x90B0", "2", "uint", "@ 200A+"},
    {"0x90B2", "2", "uint", "Charge started < 17V"},
    {"0x90B4", "2", "uint", "Charge started 17-18V"},
    {"0x90B6", "2", "uint", "Charge started 18-19V"},
    {"0x90B8", "2", "uint", "Charge started 19-20V"},
    {"0x90BA", "2", "uint", "Charge started 20V+"},
    {"0x90BC", "2", "uint", "Charge ended < 17V"},
    {"0x90BE", "2", "uint", "Charge ended 17-18V"},
    {"0x90C0", "2", "uint", "Charge ended 18-19V"},
    {"0x90C2", "2", "uint", "Charge ended 19-20V"},
    {"0x90C4", "2", "uint", "Charge ended 20V+"},
};
